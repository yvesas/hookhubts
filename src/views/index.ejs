<%- include('partials/header') %>

<h1 class="text-3xl font-bold mb-6">Event History</h1>

<div class="card bg-base-100 shadow-xl mb-6">
  <div class="card-body">
    <form class="flex gap-4 items-end" method="GET" action="/">
      <div class="form-control">
        <label class="label"><span class="label-text">Provider</span></label>
        <select name="providerId" class="select select-bordered">
          <option value="">All</option>
          <% providers.forEach(p => { %>
            <option value="<%= p.id %>" <%= filters.providerId === p.id ? 'selected' : '' %>><%= p.name %></option>
          <% }) %>
        </select>
      </div>
      <div class="form-control">
        <label class="label"><span class="label-text">Event Type</span></label>
        <input type="text" name="eventType" value="<%= filters.eventType || '' %>" class="input input-bordered" placeholder="message, etc." />
      </div>
      <button class="btn btn-primary">Filter</button>
      <a href="/" class="btn btn-ghost">Reset</a>
    </form>
  </div>
</div>

<div class="overflow-x-auto">
  <table class="table w-full">
    <thead>
      <tr>
        <th>Time</th>
        <th>Provider</th>
        <th>Type</th>
        <th>External ID</th>
        <th>Sender</th>
        <th>Body</th>
      </tr>
    </thead>
    <tbody>
      <% events.forEach(evt => { %>
        <tr>
          <td><%= new Date(evt.timestamp).toLocaleString() %></td>
          <td><div class="badge badge-outline"><%= evt.provider_name %></div></td>
          <td><%= evt.event_type %></td>
          <td><%= evt.external_event_id %></td>
          <td><%= evt.sender_id %></td>
          <td><div class="truncate max-w-xs"><%= evt.message_body %></div></td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<%- include('partials/footer') %>
